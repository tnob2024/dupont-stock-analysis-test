プロジェクト仕様書：デュポン分析に基づく日本株のクオンツ分析
1. プロジェクト概要
本プロジェクトは、金融データ分析のアイデアをPythonで体系的に実装することを第一の目的とした、学習用の試験的なコードです。 日本株（日経225採用銘柄）を対象とし、企業の収益性の「質」を測る指標としてデュポン分析を応用し、その指標が将来の株価パフォーマンスを予測する上で有効なファクターとなり得るかを検証します。

データ取得、ファクター計算、可視化といった機能をモジュール化し、保守性・拡張性の高い構造の設計に主眼を置いています。

【ご注意】
本分析は、無料でアクセス可能なyfinanceのデータに依存しており、取得できる財務データが限られています。そのため、出力される分析結果そのものに投資判断に利用できるほどの価値はありません。 あくまで、分析手法の有効性を検証する「プロセス」を実装・提示するためのデモンストレーションとしてご覧ください。

2. 分析の目的と仮説
本分析の中心的な目的は、以下の仮説を検証することです。

「デュポン分析に基づき算出された『ROEの質』が高い企業の株価パフォーマンスは、将来的に市場平均（日経平均株価）を上回る傾向にあるか？」

この問いに答えるため、単にROEの数値が高い企業ではなく、その構成要素である「利益率」と「資産効率性」によってROEを達成している企業を「質が高い」と定義し、その有効性を多角的に検証します。

3. 主要な分析手法
3.1. ROEクオリティスコア
本分析の核となる独自指標です。デュポン分析の3要素を、企業の財務状況に応じて以下のように評価し、スコア化します。

プラス評価: 事業の本源的な強さを示す要素

ProfitMargin (売上高当期純利益率)

AssetTurnover (総資産回転率)

マイナス評価: 財務リスクを高める可能性がある要素

FinancialLeverage (財務レバレッジ)

計算式:
ROEクオリティスコア = (正規化された利益率 + 正規化された資産回転率) - 正規化された財務レバレッジ

※各要素は、同年度の分析対象企業内での相対的な位置を示すため、Zスコア（偏差値）に正規化してから計算されます。

3.2. 超過リターン（アルファ）
市場全体の動きに左右されない、選択銘柄の実力を測るために、超過リターン（アルファ）を算出します。

計算式:
超過リターン = 個別銘柄の将来リターン - 同期間の日経平均株価のリターン

3.3. 検証アプローチ
上記の指標を用い、以下の2つの異なるアプローチで仮説を検証します。

最新データでの優良銘柄比較:
各企業の最新の財務データに基づき、「ROEクオリティスコア」が高い上位10社と低い下位10社を抽出し、その後の1年間の超過リターンを比較します。

企業内での時系列比較（ヒット率分析）:
各企業内で、2つの期間を比較します。「ROEクオリティスコアが改善した企業群」の中から、「実際に超過リターンも改善した企業」の割合をヒット率として算出します。これにより、「質の改善がリターンの改善に繋がる」という仮説を評価します。

4. プロジェクトの構成
本プロジェクトは、1つのJupyter Notebookと4つのPythonファイルで構成されています。

main.ipynb: 分析の全プロセスを統括するJupyter Notebook。このノートブックのセルを実行することで分析が開始されます。

config.py: 分析対象の銘柄リストやベンチマークのティッカーなど、変更可能な設定値を管理します。

data_fetcher.py: yfinanceライブラリを介したデータ取得処理を専門に担当します。

factor_engine.py: 取得した生データから、デュポン分析の各要素やROEクオリティスコア、超過リターンなどの計算を担当します。

visualizer.py: 計算された最終的なデータフレームを基に、各種分析グラフを描画します。

5. 実行方法
5.1. 実行環境
以下のライブラリが必要です。requirements.txtファイルを作成し、pip install -r requirements.txtで一括インストールすることを推奨します。

yfinance

pandas

numpy

matplotlib

seaborn

5.2. 実行手順
Jupyter Notebook (main.ipynb) と、4つの.pyファイル (config.py, data_fetcher.py, factor_engine.py, visualizer.py) を同じディレクトリに配置します。

Jupyter Labでmain.ipynbを開きます。

ノートブックの上から順にセルを実行します。

5.3. キャッシュ機能
初回実行時には、yfinanceからデータを取得するため時間がかかります。実行後、計算結果はcomprehensive_analysis_data.pklというキャッシュファイルに自動で保存されます。
2回目以降の実行時は、このキャッシュファイルを読み込むため、分析が数秒で完了します。データを更新したい場合は、この.pklファイルを削除してから再実行してください。

6. 出力結果
本コードを実行すると、以下の分析結果がグラフとして表示されます。

最新データに基づく優良・注意銘柄のパフォーマンス:

最新の「ROEクオリティスコア」で上位10社と下位10社を抽出し、それぞれの1年後超過リターンを比較する棒グラフ。

企業内時系列比較（ヒット率分析）:

「ROEの質が改善すればリターンも改善する」という仮説が、個々の企業においてどれくらいの確率で成立したかを示すヒット率の棒グラフ。

（参考）プールデータ分析:

全期間・全銘柄のデータを集計し、「ROEクオリティスコア」の高さとリターンの関係性を検証する五分位分析グラフなど。